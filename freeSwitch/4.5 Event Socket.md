# Event Socket

通过 Event Socket 可以让外部程序控制 FreeSWITCH。

## 内连模式与外连模式

内连模式是外部程序作为客户端连接到 FS（服务器）上，客户端通过订阅 FS 事件，及向 FS 发送命令 API（uuid_ 族）来对 Channel 进行操作。

外连模式是 FS 通过 socket APP 作为客户端连接到外部的服务器上，告知服务器当前呼叫的相关信息，由服务器下发控制指令（交互语言被称为 ESL，Event Socket Library）。

## ESL

```sh
telnet localhost 8021              # 连接
auth ClueCon                       # 授权
events plain CHANNEL_CREATE CUSTOM # 订阅事件
api sofia status                   # 发送 API
```

## ACL

[ACL](https://freeswitch.org/confluence/pages/viewpage.action?pageId=3965687)

Access Control List，一个定义可允许的访问某对象的网络列表。

主要的配置文件在 `autoload_configs/acl.conf.xml` 中配置 ACL。

ACL 的使用分布在不同的模块位置进行控制。

- Sip Profile
- Event Socket

所以，要连接 Event Socket 的话，
1. 先在 `conf/autoload_configs/acl.conf.xml` 中*某个?* list 标签内 allow 发起端的 IP
2. 在 `conf/autoload_configs/event_socket.conf.xml` 中配置参数 `<param name="apply-inbound-acl" value="lan"/>`（`lan` 即 acl 对应 list 的 name 属性）

## Event Socket 示例

### CHANNEL_ANSWER

```sh
Content-Length: 6706
Content-Type: text/event-plain


Event-Name: CHANNEL_ANSWER
Core-UUID: 58b0eca4-6f3d-11ee-be1e-d389057ab34a
FreeSWITCH-Hostname: bj-ccapp-press001
FreeSWITCH-Switchname: bj-ccapp-press001
FreeSWITCH-IPv4: 192.168.1.112
FreeSWITCH-IPv6: %3A%3A1
Event-Date-Local: 2023-10-21%2018%3A39%3A07
Event-Date-GMT: Sat,%2021%20Oct%202023%2010%3A39%3A07%20GMT
Event-Date-Timestamp: 1697884747739022
Event-Calling-File: switch_channel.c
Event-Calling-Function: switch_channel_perform_mark_answered
Event-Calling-Line-Number: 3884
Event-Sequence: 23199
Channel-State: CS_EXECUTE
Channel-Call-State: EARLY
Channel-State-Number: 4
Channel-Name: sofia/external/18217562304%40116.62.225.16
Unique-ID: 10166aca-6ffe-11ee-8251-d389057ab34a
Call-Direction: inbound
Presence-Call-Direction: inbound
Channel-HIT-Dialplan: true
Channel-Call-UUID: 10166aca-6ffe-11ee-8251-d389057ab34a
Answer-State: answered
Channel-Read-Codec-Name: PCMA
Channel-Read-Codec-Rate: 8000
Channel-Read-Codec-Bit-Rate: 64000
Channel-Write-Codec-Name: PCMA
Channel-Write-Codec-Rate: 8000
Channel-Write-Codec-Bit-Rate: 64000
Caller-Direction: inbound
Caller-Logical-Direction: inbound
Caller-Username: 18217562304
Caller-Dialplan: XML
Caller-Caller-ID-Name: 18217562304
Caller-Caller-ID-Number: 18217562304
Caller-Orig-Caller-ID-Name: 18217562304
Caller-Orig-Caller-ID-Number: 18217562304
Caller-Network-Addr: 116.62.225.16
Caller-ANI: 18217562304
Caller-Destination-Number: 02863804726
Caller-Unique-ID: 10166aca-6ffe-11ee-8251-d389057ab34a
Caller-Source: mod_sofia
Caller-Context: public
Caller-Channel-Name: sofia/external/18217562304%40116.62.225.16
Caller-Profile-Index: 1
Caller-Profile-Created-Time: 1697884747719016
Caller-Channel-Created-Time: 1697884747719016
Caller-Channel-Answered-Time: 1697884747739022
Caller-Channel-Progress-Time: 1697884747739022
Caller-Channel-Progress-Media-Time: 1697884747739022
Caller-Channel-Hangup-Time: 0
Caller-Channel-Transfer-Time: 0
Caller-Channel-Resurrect-Time: 0
Caller-Channel-Bridged-Time: 0
Caller-Channel-Last-Hold: 0
Caller-Channel-Hold-Accum: 0
Caller-Screen-Bit: true
Caller-Privacy-Hide-Name: false
Caller-Privacy-Hide-Number: false
variable_direction: inbound
variable_uuid: 10166aca-6ffe-11ee-8251-d389057ab34a
variable_session_id: 16
variable_sip_from_user: 18217562304
variable_sip_from_uri: 18217562304%40116.62.225.16
variable_sip_from_host: 116.62.225.16
variable_video_media_flow: disabled
variable_text_media_flow: disabled
variable_channel_name: sofia/external/18217562304%40116.62.225.16
variable_sip_call_id: 2bbb296963616c6c2f91d00d%40116.62.225.16
variable_sip_local_network_addr: 39.97.97.165
variable_sip_network_ip: 116.62.225.16
variable_sip_network_port: 7854
variable_sip_invite_stamp: 1697884747719016
variable_sip_received_ip: 116.62.225.16
variable_sip_received_port: 7854
variable_sip_via_protocol: udp
variable_sip_from_user_stripped: 18217562304
variable_sip_from_tag: 69b80ed5583ca5e7
variable_sofia_profile_name: external
variable_sofia_profile_url: sip%3Amod_sofia%4039.97.97.165%3A8891
variable_recovery_profile_name: external
variable_sip_full_via: SIP/2.0/UDP%20116.62.225.16%3A7854%3Bbranch%3Dz9hG4bK1e0fde1a63d5f18d
variable_sip_full_from: %3Csip%3A18217562304%40116.62.225.16%3E%3Btag%3D69b80ed5583ca5e7
variable_sip_full_to: %3Csip%3A02863804726%4039.97.97.165%3E
variable_sip_allow: INVITE,%20ACK,%20CANCEL,%20BYE,%20OPTIONS,%20INFO,%20UPDATE,%20PRACK
variable_sip_req_user: 02863804726
variable_sip_req_uri: 02863804726%4039.97.97.165
variable_sip_req_host: 39.97.97.165
variable_sip_to_user: 02863804726
variable_sip_to_uri: 02863804726%4039.97.97.165
variable_sip_to_host: 39.97.97.165
variable_sip_contact_user: 18217562304
variable_sip_contact_port: 7854
variable_sip_contact_uri: 18217562304%40116.62.225.16%3A7854
variable_sip_contact_host: 116.62.225.16
variable_sip_user_agent: VOS2009%20V2.1.7.01
variable_sip_via_host: 116.62.225.16
variable_sip_via_port: 7854
variable_switch_r_sdp: v%3D0%0D%0Ao%3D-%2043595%2043595%20IN%20IP4%2047.103.169.68%0D%0As%3DVOS2009%0D%0Ac%3DIN%20IP4%2047.103.169.68%0D%0At%3D0%200%0D%0Am%3Daudio%2024024%20RTP/AVP%208%20101%0D%0Aa%3Drtpmap%3A8%20PCMA/8000%0D%0Aa%3Drtpmap%3A101%20telephone-event/8000%0D%0Aa%3Dfmtp%3A101%200-16%0D%0Aa%3Dptime%3A20%0D%0A
variable_ep_codec_string: CORE_PCM_MODULE.PCMA%408000h%4020i%4064000b
variable_DP_MATCH: ARRAY%3A%3A02863804726%7C%3A02863804726
variable_call_uuid: 10166aca-6ffe-11ee-8251-d389057ab34a
variable_lin_uuid: 10166aca-6ffe-11ee-8251-d389057ab34a
variable_lin_workflow: in
variable_lin_app_id: a54a8b77-f12d-4ac9-742d-5b2bef5c4d11
variable_stream_tts: 1
variable_limit_ignore_transfer: true
variable_curl_response_data: 100
variable_curl_response_code: 200
variable_limit_usage: 1
variable_limit_usage_preview.ccps.tryudesk.com_02863804726: 1
variable_limit_rate: 0
variable_limit_rate_preview.ccps.tryudesk.com_02863804726: 0
variable_limit_backend: hash
variable_lin_called_number: 02863804726
variable_lin_caller_number: 18217562304
variable_lin_called_display: 02863804726
variable_hold_music: /var/cc_soundfile/queue_hold_music/waitmusic.wav
variable_bridge_export_vars: lin_uuid,lin_workflow,stream_tts,lin_called_number,lin_caller_number,lin_called_display,hold_music
variable_cc_export_vars: lin_uuid
variable_max_forwards: 120
variable_sip_to_tag: 2Z7Fv3365g60F
variable_current_application: answer
variable_rtp_use_codec_string: PCMA,PCMU
variable_remote_video_media_flow: inactive
variable_remote_text_media_flow: inactive
variable_remote_audio_media_flow: sendrecv
variable_audio_media_flow: sendrecv
variable_rtp_audio_recv_pt: 8
variable_rtp_use_codec_name: PCMA
variable_rtp_use_codec_rate: 8000
variable_rtp_use_codec_ptime: 20
variable_rtp_use_codec_channels: 1
variable_rtp_last_audio_codec_string: PCMA%408000h%4020i%401c
variable_read_codec: PCMA
variable_original_read_codec: PCMA
variable_read_rate: 8000
variable_original_read_rate: 8000
variable_write_codec: PCMA
variable_write_rate: 8000
variable_dtmf_type: rfc2833
variable_local_media_ip: 192.168.1.112
variable_local_media_port: 28522
variable_advertised_media_ip: 39.97.97.165
variable_rtp_use_timer_name: soft
variable_rtp_use_pt: 8
variable_rtp_use_ssrc: 1228528835
variable_rtp_2833_send_payload: 101
variable_rtp_2833_recv_payload: 101
variable_remote_media_ip: 47.103.169.68
variable_remote_media_port: 24024
variable_endpoint_disposition: EARLY%20MEDIA
variable_rtp_local_sdp_str: v%3D0%0D%0Ao%3DFreeSWITCH%201697856225%201697856226%20IN%20IP4%2039.97.97.165%0D%0As%3DFreeSWITCH%0D%0Ac%3DIN%20IP4%2039.97.97.165%0D%0At%3D0%200%0D%0Am%3Daudio%2028522%20RTP/AVP%208%20101%0D%0Aa%3Drtpmap%3A8%20PCMA/8000%0D%0Aa%3Drtpmap%3A101%20telephone-event/8000%0D%0Aa%3Dfmtp%3A101%200-15%0D%0Aa%3Dptime%3A20%0D%0Aa%3Dsendrecv%0D%0A
```

### CHANNEL_ORIGINATE

```sh
Content-Length: 4964
Content-Type: text/event-plain

Event-Name: CHANNEL_ORIGINATE
Core-UUID: 58b0eca4-6f3d-11ee-be1e-d389057ab34a
FreeSWITCH-Hostname: bj-ccapp-press001
FreeSWITCH-Switchname: bj-ccapp-press001
FreeSWITCH-IPv4: 192.168.1.112
FreeSWITCH-IPv6: %3A%3A1
Event-Date-Local: 2023-10-21%2018%3A54%3A48
Event-Date-GMT: Sat,%2021%20Oct%202023%2010%3A54%3A48%20GMT
Event-Date-Timestamp: 1697885688839044
Event-Calling-File: switch_core_state_machine.c
Event-Calling-Function: switch_core_session_run
Event-Calling-Line-Number: 632
Event-Sequence: 24627
Channel-State: CS_INIT
Channel-Call-State: DOWN
Channel-State-Number: 2
Channel-Name: sofia/internal/oiqeo7j7%408jddbjqqogg6.invalid
Unique-ID: 41094f06-7000-11ee-8388-d389057ab34a
Call-Direction: outbound
Presence-Call-Direction: outbound
Channel-HIT-Dialplan: false
Channel-Presence-ID: 91630476951604%40preview.ccps.tryudesk.com
Channel-Call-UUID: 41094f06-7000-11ee-8388-d389057ab34a
Answer-State: ringing
Caller-Direction: outbound
Caller-Logical-Direction: outbound
Caller-Caller-ID-Name: 18217562304
Caller-Caller-ID-Number: 18217562304
Caller-Orig-Caller-ID-Name: 18217562304
Caller-Orig-Caller-ID-Number: 18217562304
Caller-Callee-ID-Name: Outbound%20Call
Caller-Callee-ID-Number: oiqeo7j7
Caller-ANI: 18217562304
Caller-Destination-Number: oiqeo7j7
Caller-Unique-ID: 41094f06-7000-11ee-8388-d389057ab34a
Caller-Source: src/switch_ivr_originate.c
Caller-Context: default
Caller-Channel-Name: sofia/internal/oiqeo7j7%408jddbjqqogg6.invalid
Caller-Profile-Index: 1
Caller-Profile-Created-Time: 1697885688839044
Caller-Channel-Created-Time: 1697885688839044
Caller-Channel-Answered-Time: 0
Caller-Channel-Progress-Time: 0
Caller-Channel-Progress-Media-Time: 0
Caller-Channel-Hangup-Time: 0
Caller-Channel-Transfer-Time: 0
Caller-Channel-Resurrect-Time: 0
Caller-Channel-Bridged-Time: 0
Caller-Channel-Last-Hold: 0
Caller-Channel-Hold-Accum: 0
Caller-Screen-Bit: true
Caller-Privacy-Hide-Name: false
Caller-Privacy-Hide-Number: false
variable_direction: outbound
variable_is_outbound: true
variable_uuid: 41094f06-7000-11ee-8388-d389057ab34a
variable_call_uuid: 41094f06-7000-11ee-8388-d389057ab34a
variable_session_id: 22
variable_sip_local_network_addr: 39.97.97.165
variable_sip_profile_name: internal
variable_media_webrtc: true
variable_video_media_flow: disabled
variable_text_media_flow: disabled
variable_channel_name: sofia/internal/oiqeo7j7%408jddbjqqogg6.invalid
variable_sip_destination_url: sip%3Aoiqeo7j7%408jddbjqqogg6.invalid%3Btransport%3Dws%3Bfs_nat%3Dyes%3Bfs_path%3Dsip%3Aoiqeo7j7%40119.57.115.195%3A25434%3Btransport%3Dwss
variable_lin_uuid: 3de37658-7000-11ee-8362-d389057ab34a
variable_origination_caller_id_name: 18217562304
variable_origination_caller_id_number: 18217562304
variable_ignore_early_media: true
variable_originate_timeout: 60
variable_dialed_user: 91630476951604
variable_dialed_domain: preview.ccps.tryudesk.com
variable_sip_invite_domain: preview.ccps.tryudesk.com
variable_presence_id: 91630476951604%40preview.ccps.tryudesk.com
variable_originate_early_media: false
variable_rtp_use_codec_string: PCMA,PCMU
variable_local_media_ip: 192.168.1.112
variable_local_media_port: 31110
variable_advertised_media_ip: 39.97.97.165
variable_audio_media_flow: sendrecv
variable_rtp_local_sdp_str: v%3D0%0D%0Ao%3DFreeSWITCH%201697854578%201697854579%20IN%20IP4%2039.97.97.165%0D%0As%3DFreeSWITCH%0D%0Ac%3DIN%20IP4%2039.97.97.165%0D%0At%3D0%200%0D%0Aa%3Dmsid-semantic%3A%20WMS%208hbajWAJOl8BGjSup6pPgOnKaMEnTsqR%0D%0Am%3Daudio%2031110%20RTP/SAVPF%208%200%20101%2013%0D%0Aa%3Drtpmap%3A8%20PCMA/8000%0D%0Aa%3Drtpmap%3A0%20PCMU/8000%0D%0Aa%3Drtpmap%3A101%20telephone-event/8000%0D%0Aa%3Dfingerprint%3Asha-256%2096%3A2C%3AF4%3A31%3ADE%3AB3%3AAF%3A98%3A85%3A25%3A06%3AB6%3ABB%3A6C%3AEC%3A3E%3AEE%3A28%3A87%3A72%3A54%3A99%3AC3%3AB1%3A7D%3AE6%3A1E%3A19%3A68%3A58%3AC3%3AD9%0D%0Aa%3Dsetup%3Aactpass%0D%0Aa%3Drtcp-mux%0D%0Aa%3Drtcp%3A31110%20IN%20IP4%2039.97.97.165%0D%0Aa%3Dssrc%3A1362983232%20cname%3AzsRJeijSuik1r2lG%0D%0Aa%3Dssrc%3A1362983232%20msid%3A8hbajWAJOl8BGjSup6pPgOnKaMEnTsqR%20a0%0D%0Aa%3Dssrc%3A1362983232%20mslabel%3A8hbajWAJOl8BGjSup6pPgOnKaMEnTsqR%0D%0Aa%3Dssrc%3A1362983232%20label%3A8hbajWAJOl8BGjSup6pPgOnKaMEnTsqRa0%0D%0Aa%3Dice-ufrag%3AZBl6fzGgcatVtJCS%0D%0Aa%3Dice-pwd%3A2ks6tCPNKZE1SQyHhKEn9atb%0D%0Aa%3Dcandidate%3A0786345822%201%20udp%202130706431%2039.97.97.165%2031110%20typ%20host%20generation%200%0D%0Aa%3Dcandidate%3A0786345822%202%20udp%202130706431%2039.97.97.165%2031110%20typ%20host%20generation%200%0D%0Aa%3Drtpmap%3A13%20CN/8000%0D%0Aa%3Dptime%3A20%0D%0Aa%3Dsendrecv%0D%0A
variable_sip_outgoing_contact_uri: %3Csip%3Amod_sofia%4039.97.97.165%3A5474%3E
variable_sip_req_uri: oiqeo7j7%408jddbjqqogg6.invalid%3Btransport%3Dws
variable_sip_to_host: 8jddbjqqogg6.invalid
variable_sip_from_host: preview.ccps.tryudesk.com
variable_sip_nat_detected: true
variable_sofia_profile_name: internal
variable_recovery_profile_name: internal
variable_sofia_profile_url: sip%3Amod_sofia%4039.97.97.165%3A5474
```

### CHANNEL_ANSWER

```sh
Content-Length: 8739
Content-Type: text/event-plain

Event-Name: CHANNEL_ANSWER
Core-UUID: 58b0eca4-6f3d-11ee-be1e-d389057ab34a
FreeSWITCH-Hostname: bj-ccapp-press001
FreeSWITCH-Switchname: bj-ccapp-press001
FreeSWITCH-IPv4: 192.168.1.112
FreeSWITCH-IPv6: %3A%3A1
Event-Date-Local: 2023-10-21%2018%3A55%3A05
Event-Date-GMT: Sat,%2021%20Oct%202023%2010%3A55%3A05%20GMT
Event-Date-Timestamp: 1697885705199019
Event-Calling-File: switch_channel.c
Event-Calling-Function: switch_channel_perform_mark_answered
Event-Calling-Line-Number: 3884
Event-Sequence: 24643
Channel-State: CS_CONSUME_MEDIA
Channel-Call-State: RINGING
Channel-State-Number: 7
Channel-Name: sofia/internal/oiqeo7j7%408jddbjqqogg6.invalid
Unique-ID: 41094f06-7000-11ee-8388-d389057ab34a
Call-Direction: outbound
Presence-Call-Direction: outbound
Channel-HIT-Dialplan: false
Channel-Presence-ID: 91630476951604%40preview.ccps.tryudesk.com
Channel-Call-UUID: 41094f06-7000-11ee-8388-d389057ab34a
Answer-State: answered
Channel-Read-Codec-Name: PCMA
Channel-Read-Codec-Rate: 8000
Channel-Read-Codec-Bit-Rate: 64000
Channel-Write-Codec-Name: PCMA
Channel-Write-Codec-Rate: 8000
Channel-Write-Codec-Bit-Rate: 64000
Caller-Direction: outbound
Caller-Logical-Direction: outbound
Caller-Caller-ID-Name: 18217562304
Caller-Caller-ID-Number: 18217562304
Caller-Orig-Caller-ID-Name: 18217562304
Caller-Orig-Caller-ID-Number: 18217562304
Caller-Callee-ID-Name: Outbound%20Call
Caller-Callee-ID-Number: oiqeo7j7
Caller-Network-Addr: 119.57.115.195
Caller-ANI: 18217562304
Caller-Destination-Number: oiqeo7j7
Caller-Unique-ID: 41094f06-7000-11ee-8388-d389057ab34a
Caller-Source: src/switch_ivr_originate.c
Caller-Context: default
Caller-Channel-Name: sofia/internal/oiqeo7j7%408jddbjqqogg6.invalid
Caller-Profile-Index: 1
Caller-Profile-Created-Time: 1697885688839044
Caller-Channel-Created-Time: 1697885688839044
Caller-Channel-Answered-Time: 1697885705199019
Caller-Channel-Progress-Time: 1697885688939047
Caller-Channel-Progress-Media-Time: 0
Caller-Channel-Hangup-Time: 0
Caller-Channel-Transfer-Time: 0
Caller-Channel-Resurrect-Time: 0
Caller-Channel-Bridged-Time: 0
Caller-Channel-Last-Hold: 0
Caller-Channel-Hold-Accum: 0
Caller-Screen-Bit: true
Caller-Privacy-Hide-Name: false
Caller-Privacy-Hide-Number: false
variable_direction: outbound
variable_is_outbound: true
variable_uuid: 41094f06-7000-11ee-8388-d389057ab34a
variable_call_uuid: 41094f06-7000-11ee-8388-d389057ab34a
variable_session_id: 22
variable_sip_profile_name: internal
variable_media_webrtc: true
variable_video_media_flow: disabled
variable_text_media_flow: disabled
variable_channel_name: sofia/internal/oiqeo7j7%408jddbjqqogg6.invalid
variable_sip_destination_url: sip%3Aoiqeo7j7%408jddbjqqogg6.invalid%3Btransport%3Dws%3Bfs_nat%3Dyes%3Bfs_path%3Dsip%3Aoiqeo7j7%40119.57.115.195%3A25434%3Btransport%3Dwss
variable_lin_uuid: 3de37658-7000-11ee-8362-d389057ab34a
variable_origination_caller_id_name: 18217562304
variable_origination_caller_id_number: 18217562304
variable_ignore_early_media: true
variable_originate_timeout: 60
variable_dialed_user: 91630476951604
variable_dialed_domain: preview.ccps.tryudesk.com
variable_sip_invite_domain: preview.ccps.tryudesk.com
variable_presence_id: 91630476951604%40preview.ccps.tryudesk.com
variable_originate_early_media: false
variable_audio_media_flow: sendrecv
variable_rtp_local_sdp_str: v%3D0%0D%0Ao%3DFreeSWITCH%201697854578%201697854579%20IN%20IP4%2039.97.97.165%0D%0As%3DFreeSWITCH%0D%0Ac%3DIN%20IP4%2039.97.97.165%0D%0At%3D0%200%0D%0Aa%3Dmsid-semantic%3A%20WMS%208hbajWAJOl8BGjSup6pPgOnKaMEnTsqR%0D%0Am%3Daudio%2031110%20RTP/SAVPF%208%200%20101%2013%0D%0Aa%3Drtpmap%3A8%20PCMA/8000%0D%0Aa%3Drtpmap%3A0%20PCMU/8000%0D%0Aa%3Drtpmap%3A101%20telephone-event/8000%0D%0Aa%3Dfingerprint%3Asha-256%2096%3A2C%3AF4%3A31%3ADE%3AB3%3AAF%3A98%3A85%3A25%3A06%3AB6%3ABB%3A6C%3AEC%3A3E%3AEE%3A28%3A87%3A72%3A54%3A99%3AC3%3AB1%3A7D%3AE6%3A1E%3A19%3A68%3A58%3AC3%3AD9%0D%0Aa%3Dsetup%3Aactpass%0D%0Aa%3Drtcp-mux%0D%0Aa%3Drtcp%3A31110%20IN%20IP4%2039.97.97.165%0D%0Aa%3Dssrc%3A1362983232%20cname%3AzsRJeijSuik1r2lG%0D%0Aa%3Dssrc%3A1362983232%20msid%3A8hbajWAJOl8BGjSup6pPgOnKaMEnTsqR%20a0%0D%0Aa%3Dssrc%3A1362983232%20mslabel%3A8hbajWAJOl8BGjSup6pPgOnKaMEnTsqR%0D%0Aa%3Dssrc%3A1362983232%20label%3A8hbajWAJOl8BGjSup6pPgOnKaMEnTsqRa0%0D%0Aa%3Dice-ufrag%3AZBl6fzGgcatVtJCS%0D%0Aa%3Dice-pwd%3A2ks6tCPNKZE1SQyHhKEn9atb%0D%0Aa%3Dcandidate%3A0786345822%201%20udp%202130706431%2039.97.97.165%2031110%20typ%20host%20generation%200%0D%0Aa%3Dcandidate%3A0786345822%202%20udp%202130706431%2039.97.97.165%2031110%20typ%20host%20generation%200%0D%0Aa%3Drtpmap%3A13%20CN/8000%0D%0Aa%3Dptime%3A20%0D%0Aa%3Dsendrecv%0D%0A
variable_sip_outgoing_contact_uri: %3Csip%3Amod_sofia%4039.97.97.165%3A5474%3E
variable_sip_req_uri: oiqeo7j7%408jddbjqqogg6.invalid%3Btransport%3Dws
variable_sip_nat_detected: true
variable_sofia_profile_name: internal
variable_recovery_profile_name: internal
variable_sofia_profile_url: sip%3Amod_sofia%4039.97.97.165%3A5474
variable_lin_chain_api_id: 0
variable_lin_chain_ivr_id: 1
variable_lin_chain_queue_id: 1
variable_sip_local_network_addr: 39.97.97.165
variable_sip_reply_host: 119.57.115.195
variable_sip_reply_port: 25434
variable_sip_network_ip: 119.57.115.195
variable_sip_network_port: 25434
variable_sip_recover_contact: %3Csip%3Aoiqeo7j7%408jddbjqqogg6.invalid%3Btransport%3Dws%3E
variable_sip_full_via: SIP/2.0/WSS%2039.97.97.165%3A5474%3Brport%3Bbranch%3Dz9hG4bKgBKgFS1yr944Q
variable_sip_recover_via: SIP/2.0/WSS%2039.97.97.165%3A5474%3Brport%3Bbranch%3Dz9hG4bKgBKgFS1yr944Q
variable_sip_from_display: 18217562304
variable_sip_full_from: %2218217562304%22%20%3Csip%3A18217562304%40preview.ccps.tryudesk.com%3E%3Btag%3DF56B0v17Km2gp
variable_sip_full_to: %3Csip%3Aoiqeo7j7%408jddbjqqogg6.invalid%3Btransport%3Dws%3E%3Btag%3Dappbac58jp
variable_sip_from_user: 18217562304
variable_sip_from_uri: 18217562304%40preview.ccps.tryudesk.com
variable_sip_from_host: preview.ccps.tryudesk.com
variable_sip_to_params: transport%3Dws
variable_sip_to_user: oiqeo7j7
variable_sip_to_uri: oiqeo7j7%408jddbjqqogg6.invalid
variable_sip_to_host: 8jddbjqqogg6.invalid
variable_sip_contact_params: transport%3Dws
variable_sip_contact_user: oiqeo7j7
variable_sip_contact_uri: oiqeo7j7%408jddbjqqogg6.invalid
variable_sip_contact_host: 8jddbjqqogg6.invalid
variable_sip_to_tag: appbac58jp
variable_sip_from_tag: F56B0v17Km2gp
variable_sip_cseq: 74389052
variable_sip_call_id: 1867cbde-eaa3-123c-e8a5-00163e102122
variable_switch_r_sdp: v%3D0%0D%0Ao%3D-%20912867070678224306%202%20IN%20IP4%20127.0.0.1%0D%0As%3D-%0D%0At%3D0%200%0D%0Aa%3Dmsid-semantic%3A%20WMS%200213f4d8-c8d0-4ef2-89bc-b6bb8e14e964%0D%0Am%3Daudio%2049766%20RTP/SAVPF%208%200%20101%2013%0D%0Ac%3DIN%20IP4%202.0.0.1%0D%0Aa%3Drtpmap%3A8%20PCMA/8000%0D%0Aa%3Drtpmap%3A0%20PCMU/8000%0D%0Aa%3Drtpmap%3A101%20telephone-event/8000%0D%0Aa%3Drtpmap%3A13%20CN/8000%0D%0Aa%3Drtcp%3A9%20IN%20IP4%200.0.0.0%0D%0Aa%3Dcandidate%3A3356974846%201%20udp%202122260223%202.0.0.1%2049766%20typ%20host%20generation%200%20network-id%201%20network-cost%2050%0D%0Aa%3Dice-ufrag%3A2Y2y%0D%0Aa%3Dice-pwd%3A7/HJS%2BSJmL9G6GQ3OBiFeYik%0D%0Aa%3Dice-options%3Atrickle%0D%0Aa%3Dfingerprint%3Asha-256%2051%3A28%3A88%3A2A%3ADB%3AD8%3A21%3A9B%3AE6%3A32%3A68%3A16%3A80%3A43%3AAC%3A50%3AA9%3AD0%3A76%3AE2%3A4B%3A32%3AD9%3A58%3A49%3A34%3A2C%3A4F%3AC6%3AB8%3AA3%3A47%0D%0Aa%3Dsetup%3Aactive%0D%0Aa%3Dmid%3A0%0D%0Aa%3Drtcp-mux%0D%0Aa%3Dssrc%3A2255669696%20cname%3ADqgjzaY/bzZz1sQJ%0D%0Aa%3Dssrc%3A2255669696%20msid%3A0213f4d8-c8d0-4ef2-89bc-b6bb8e14e964%20bf93b77d-9e0f-44f7-bea4-6072b20f45ea%0D%0A
variable_ep_codec_string: CORE_PCM_MODULE.PCMA%408000h%4020i%4064000b,CORE_PCM_MODULE.PCMU%408000h%4020i%4064000b
variable_rtp_use_codec_string: PCMA,PCMU
variable_remote_video_media_flow: inactive
variable_remote_text_media_flow: inactive
variable_remote_audio_media_flow: sendrecv
variable_rtp_audio_recv_pt: 8
variable_rtp_use_codec_name: PCMA
variable_rtp_use_codec_rate: 8000
variable_rtp_use_codec_ptime: 20
variable_rtp_use_codec_channels: 1
variable_rtp_last_audio_codec_string: PCMA%408000h%4020i%401c
variable_read_codec: PCMA
variable_original_read_codec: PCMA
variable_read_rate: 8000
variable_original_read_rate: 8000
variable_write_codec: PCMA
variable_write_rate: 8000
variable_remote_audio_ip: 2.0.0.1
variable_remote_audio_port: 49766
variable_remote_audio_rtcp_ip: 2.0.0.1
variable_remote_audio_rtcp_port: 49766
variable_dtmf_type: rfc2833
variable_local_media_ip: 192.168.1.112
variable_local_media_port: 31110
variable_advertised_media_ip: 39.97.97.165
variable_rtp_use_timer_name: soft
variable_rtp_use_pt: 8
variable_rtp_use_ssrc: 1362983232
variable_rtp_2833_send_payload: 101
variable_rtp_2833_recv_payload: 101
variable_remote_media_ip: 2.0.0.1
variable_remote_media_port: 49766
```

### CHANNEL_HANGUP

```sh
Content-Length: 9703
Content-Type: text/event-plain

Event-Name: CHANNEL_HANGUP
Core-UUID: 58b0eca4-6f3d-11ee-be1e-d389057ab34a
FreeSWITCH-Hostname: bj-ccapp-press001
FreeSWITCH-Switchname: bj-ccapp-press001
FreeSWITCH-IPv4: 192.168.1.112
FreeSWITCH-IPv6: %3A%3A1
Event-Date-Local: 2023-10-21%2018%3A39%3A18
Event-Date-GMT: Sat,%2021%20Oct%202023%2010%3A39%3A18%20GMT
Event-Date-Timestamp: 1697884758899058
Event-Calling-File: switch_channel.c
Event-Calling-Function: switch_channel_perform_hangup
Event-Calling-Line-Number: 3426
Event-Sequence: 23351
Channel-State: CS_EXECUTE
Channel-Call-State: ACTIVE
Channel-State-Number: 10
Channel-Name: sofia/external/18217562304%40116.62.225.16
Unique-ID: 10166aca-6ffe-11ee-8251-d389057ab34a
Call-Direction: inbound
Presence-Call-Direction: inbound
Channel-HIT-Dialplan: true
Channel-Call-UUID: 10166aca-6ffe-11ee-8251-d389057ab34a
Answer-State: hangup
Hangup-Cause: NORMAL_CLEARING
Channel-Read-Codec-Name: PCMA
Channel-Read-Codec-Rate: 8000
Channel-Read-Codec-Bit-Rate: 64000
Channel-Write-Codec-Name: PCMA
Channel-Write-Codec-Rate: 8000
Channel-Write-Codec-Bit-Rate: 64000
Caller-Direction: inbound
Caller-Logical-Direction: inbound
Caller-Username: 18217562304
Caller-Dialplan: XML
Caller-Caller-ID-Name: 18217562304
Caller-Caller-ID-Number: 18217562304
Caller-Orig-Caller-ID-Name: 18217562304
Caller-Orig-Caller-ID-Number: 18217562304
Caller-Network-Addr: 116.62.225.16
Caller-ANI: 18217562304
Caller-Destination-Number: asr_gather
Caller-Unique-ID: 10166aca-6ffe-11ee-8251-d389057ab34a
Caller-Source: mod_sofia
Caller-Transfer-Source: 1697884757%3A15f58f20-6ffe-11ee-827e-d389057ab34a%3Abl_xfer%3Aasr_gather/udesk_cti/XML
Caller-Context: udesk_cti
Caller-RDNIS: in_ivr_park
Caller-Channel-Name: sofia/external/18217562304%40116.62.225.16
Caller-Profile-Index: 6
Caller-Profile-Created-Time: 1697884757579020
Caller-Channel-Created-Time: 1697884747719016
Caller-Channel-Answered-Time: 1697884747739022
Caller-Channel-Progress-Time: 1697884747739022
Caller-Channel-Progress-Media-Time: 1697884747739022
Caller-Channel-Hangup-Time: 0
Caller-Channel-Transfer-Time: 0
Caller-Channel-Resurrect-Time: 0
Caller-Channel-Bridged-Time: 0
Caller-Channel-Last-Hold: 0
Caller-Channel-Hold-Accum: 0
Caller-Screen-Bit: true
Caller-Privacy-Hide-Name: false
Caller-Privacy-Hide-Number: false
variable_direction: inbound
variable_uuid: 10166aca-6ffe-11ee-8251-d389057ab34a
variable_session_id: 16
variable_sip_from_user: 18217562304
variable_sip_from_uri: 18217562304%40116.62.225.16
variable_sip_from_host: 116.62.225.16
variable_video_media_flow: disabled
variable_text_media_flow: disabled
variable_channel_name: sofia/external/18217562304%40116.62.225.16
variable_sip_local_network_addr: 39.97.97.165
variable_sip_network_ip: 116.62.225.16
variable_sip_network_port: 7854
variable_sip_invite_stamp: 1697884747719016
variable_sip_received_ip: 116.62.225.16
variable_sip_received_port: 7854
variable_sip_via_protocol: udp
variable_sip_from_user_stripped: 18217562304
variable_sofia_profile_name: external
variable_sofia_profile_url: sip%3Amod_sofia%4039.97.97.165%3A8891
variable_recovery_profile_name: external
variable_sip_allow: INVITE,%20ACK,%20CANCEL,%20BYE,%20OPTIONS,%20INFO,%20UPDATE,%20PRACK
variable_sip_req_user: 02863804726
variable_sip_req_uri: 02863804726%4039.97.97.165
variable_sip_req_host: 39.97.97.165
variable_sip_to_user: 02863804726
variable_sip_to_uri: 02863804726%4039.97.97.165
variable_sip_to_host: 39.97.97.165
variable_sip_contact_user: 18217562304
variable_sip_contact_port: 7854
variable_sip_contact_uri: 18217562304%40116.62.225.16%3A7854
variable_sip_contact_host: 116.62.225.16
variable_sip_user_agent: VOS2009%20V2.1.7.01
variable_sip_via_host: 116.62.225.16
variable_sip_via_port: 7854
variable_switch_r_sdp: v%3D0%0D%0Ao%3D-%2043595%2043595%20IN%20IP4%2047.103.169.68%0D%0As%3DVOS2009%0D%0Ac%3DIN%20IP4%2047.103.169.68%0D%0At%3D0%200%0D%0Am%3Daudio%2024024%20RTP/AVP%208%20101%0D%0Aa%3Drtpmap%3A8%20PCMA/8000%0D%0Aa%3Drtpmap%3A101%20telephone-event/8000%0D%0Aa%3Dfmtp%3A101%200-16%0D%0Aa%3Dptime%3A20%0D%0A
variable_ep_codec_string: CORE_PCM_MODULE.PCMA%408000h%4020i%4064000b
variable_DP_MATCH: ARRAY%3A%3A02863804726%7C%3A02863804726
variable_lin_uuid: 10166aca-6ffe-11ee-8251-d389057ab34a
variable_lin_workflow: in
variable_stream_tts: 1
variable_limit_ignore_transfer: true
variable_curl_response_data: 100
variable_curl_response_code: 200
variable_limit_usage: 1
variable_limit_usage_preview.ccps.tryudesk.com_02863804726: 1
variable_limit_rate: 0
variable_limit_rate_preview.ccps.tryudesk.com_02863804726: 0
variable_limit_backend: hash
variable_lin_called_number: 02863804726
variable_lin_caller_number: 18217562304
variable_lin_called_display: 02863804726
variable_bridge_export_vars: lin_uuid,lin_workflow,stream_tts,lin_called_number,lin_caller_number,lin_called_display,hold_music
variable_cc_export_vars: lin_uuid
variable_rtp_use_codec_string: PCMA,PCMU
variable_remote_video_media_flow: inactive
variable_remote_text_media_flow: inactive
variable_remote_audio_media_flow: sendrecv
variable_audio_media_flow: sendrecv
variable_rtp_audio_recv_pt: 8
variable_rtp_use_codec_name: PCMA
variable_rtp_use_codec_rate: 8000
variable_rtp_use_codec_ptime: 20
variable_rtp_use_codec_channels: 1
variable_rtp_last_audio_codec_string: PCMA%408000h%4020i%401c
variable_read_codec: PCMA
variable_original_read_codec: PCMA
variable_read_rate: 8000
variable_original_read_rate: 8000
variable_write_codec: PCMA
variable_write_rate: 8000
variable_dtmf_type: rfc2833
variable_local_media_ip: 192.168.1.112
variable_local_media_port: 28522
variable_advertised_media_ip: 39.97.97.165
variable_rtp_use_timer_name: soft
variable_rtp_use_pt: 8
variable_rtp_use_ssrc: 1228528835
variable_rtp_2833_send_payload: 101
variable_rtp_2833_recv_payload: 101
variable_remote_media_ip: 47.103.169.68
variable_remote_media_port: 24024
variable_rtp_local_sdp_str: v%3D0%0D%0Ao%3DFreeSWITCH%201697856225%201697856226%20IN%20IP4%2039.97.97.165%0D%0As%3DFreeSWITCH%0D%0Ac%3DIN%20IP4%2039.97.97.165%0D%0At%3D0%200%0D%0Am%3Daudio%2028522%20RTP/AVP%208%20101%0D%0Aa%3Drtpmap%3A8%20PCMA/8000%0D%0Aa%3Drtpmap%3A101%20telephone-event/8000%0D%0Aa%3Dfmtp%3A101%200-15%0D%0Aa%3Dptime%3A20%0D%0Aa%3Dsendrecv%0D%0A
variable_endpoint_disposition: ANSWER
variable_hold_music: /var/cc_soundfile/default/waitmusic.wav
variable_sip_to_tag: 2Z7Fv3365g60F
variable_sip_from_tag: 69b80ed5583ca5e7
variable_sip_cseq: 21701
variable_sip_call_id: 2bbb296963616c6c2f91d00d%40116.62.225.16
variable_sip_full_via: SIP/2.0/UDP%2010.1.251.75%3A7854%3Bbranch%3Dz9hG4bK427262f07eb9d940%3Breceived%3D116.62.225.16
variable_sip_full_from: %3Csip%3A18217562304%40116.62.225.16%3E%3Btag%3D69b80ed5583ca5e7
variable_sip_full_to: %3Csip%3A02863804726%4039.97.97.165%3E%3Btag%3D2Z7Fv3365g60F
variable_transfer_history: ARRAY%3A%3A1697884748%3A106915fe-6ffe-11ee-826b-d389057ab34a%3Abl_xfer%3Ain_ivr_park/udesk_cti/XML%7C%3A1697884750%3A11e10acc-6ffe-11ee-826e-d389057ab34a%3Abl_xfer%3Aasr_gather/udesk_cti/XML%7C%3A1697884756%3A152800dc-6ffe-11ee-8278-d389057ab34a%3Abl_xfer%3Aasr_gather/udesk_cti/XML%7C%3A1697884756%3A152b0426-6ffe-11ee-827b-d389057ab34a%3Abl_xfer%3Ain_ivr_park/udesk_cti/XML%7C%3A1697884757%3A15f58f20-6ffe-11ee-827e-d389057ab34a%3Abl_xfer%3Aasr_gather/udesk_cti/XML
variable_lin_track0: customer
variable_lin_track1: agent
variable_lin_chain_api_id: 0
variable_lin_chain_ivr_id: 1
variable_lin_chain_queue_id: 0
variable_lin_record_type: ivr
variable_lin_record_id: 0
variable_lin_app_id: a54a8b77-f12d-4ac9-742d-5b2bef5c4d11
variable_RECORD_STEREO: true
variable_record_start_time: 1697884748374
variable_lin_record_file_name: /var/cc_recordings/a54a8b77-f12d-4ac9-742d-5b2bef5c4d11/ivr/20231021183908_10166aca-6ffe-11ee-8251-d389057ab34a_10166aca-6ffe-11ee-8251-d389057ab34a_18217562304.wav
variable_playback_last_offset_pos: 3226
variable_playback_seconds: 0
variable_playback_ms: 403
variable_playback_samples: 3226
variable_asr_ip: 127.0.0.1
variable_asr_port: 13040
variable_asr_type: start
variable_tts_file_generate: true
variable_asr_gather_timeout: 60
variable_dtmf_gather_switch: 0
variable_tts_content: %E7%94%A8%E6%88%B7%E4%B8%8D%E5%9B%9E%E7%AD%94%E5%A4%84%E7%90%86%E6%82%A8%E5%A5%BD%E3%80%82%E5%9C%A8%E5%90%97
variable_play_offset: 0
variable_var_play_uuid: 8e4db699-3939-4254-718c-f34e29b663ab
variable_tts_file_path: /var/cc_soundfile/a54a8b77-f12d-4ac9-742d-5b2bef5c4d11/tts/eb/ebb7879993ef2e36e4c6aa146242068e8b942ac1.wav
variable_playback_param: %7Bvar_play_uuid%3D8e4db699-3939-4254-718c-f34e29b663ab%7D/var/cc_soundfile/a54a8b77-f12d-4ac9-742d-5b2bef5c4d11/tts/eb/ebb7879993ef2e36e4c6aa146242068e8b942ac1.wav
variable_tts_config: engine%3Dali%2Cvoice_name%3DYina%2Ctext_encoding%3Dutf8%2Csample_rate%3D8000%2Cspeed%3D50%2Cvolume%3D50%2Cpitch%3D50%2Crdn%3D2
variable_tts_file_exists: false
variable_play_type: tts
variable_max_forwards: 115
variable_transfer_source: 1697884757%3A15f58f20-6ffe-11ee-827e-d389057ab34a%3Abl_xfer%3Aasr_gather/udesk_cti/XML
variable_call_uuid: 10166aca-6ffe-11ee-8251-d389057ab34a
variable_tts_file_duration: 100
variable_asr_gather_silence: 160
variable_start_play_time: 1697884757%0A
variable_current_application_data: %7Bvar_play_uuid%3D8e4db699-3939-4254-718c-f34e29b663ab%7Dudeskp%3A//play_type%3Dtts%7Capp_id%3Da54a8b77-f12d-4ac9-742d-5b2bef5c4d11%7Ctts_config%3Dengine%3Dali%2Cvoice_name%3DYina%2Ctext_encoding%3Dutf8%2Csample_rate%3D8000%2Cspeed%3D50%2Cvolume%3D50%2Cpitch%3D50%2Crdn%3D2%7Ctts_content%3D%E7%94%A8%E6%88%B7%E4%B8%8D%E5%9B%9E%E7%AD%94%E5%A4%84%E7%90%86%E6%82%A8%E5%A5%BD%E3%80%82%E5%9C%A8%E5%90%97%7Coffset%3D0
variable_current_application: playback
variable_sip_term_status: 200
variable_proto_specific_hangup_cause: sip%3A200
variable_sip_term_cause: 16
```
