# XML 用户目录

SIP 不要求一定要注册才可以打电话，但通话前仍需用户认证，认证参数即中用户目录中进行配置。即用户目录决定了哪些用户能注册到 FS 中。

```xml
<include>
    <domain name="$${domain}">
        <params>
            <param name="dial-string" value="..."/>
        </params>
        <variables>
            <variable name="record_stereo" value="true"/>
        </variables>
        <groups>
            <group name="sales">
                <users>
                    <user id="1000" type="pointer"/>
                </users>
            </group>
        </groups>
    </domain>
</include>
```

default.xml 是自带默认的配置文件。其中 `$${domain}` 默认变量值是主机 IP 地址，可以将他修改为一个域名。

- `params` 标签中定义 domain 下所有用户的公共参数。
- params 定义的 `dial-string` 变量很重要，FS 会使用 user/username 或 sofia/internal/username@domain 呼叫时会根据 username 等信息找到 dial-string 最终扩展成用户实际 SIP 地址。
- `variables` 标签定义了一些 Channel 级别的公共变量，在通话中会绑定到相应的 Channel 上形成 Channel Variables。
- `groups`、`group` 组标签，是不必要的，但可以方便地进行群呼、代接之类的业务。
- `users`、`user` 标签可以是完整的 XML，也可以是指向已存在用户的“指针”（`type="pointer"`，通过 `<user id="xxx">` 来找到）。
- 注：params 和 variables 可以出现在 user、group 或 domain 中，优先级按作用域的减小而增大。

## 动态配置

动态注册用户就不能用 XML 配置文件的方式了，可以从外接获取，如数据库。如下面配置文件 `autoload_configs/xml_curl.conf.xml`，使用标签 binding 指明绑定到 directory，使其通过 url 的方式获取注册用户。

```xml
<configuration name="xml_curl.conf" description="cURL XML Gateway">
  <bindings>
    <binding name="directory">
	<param name="gateway-url" value="127.0.0.1:4002/agent/generatexml?timestamp=20170107230000" bindings="directory"/>
    </binding>
  </bindings>
</configuration>
```
