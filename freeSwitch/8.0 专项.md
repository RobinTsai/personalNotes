## WebRTC no suitable candidates found



## WebRTC 原理了解

WebRTC 是浏览器提供的一套 API，pjsip 的信令搭载在 websocket 上，而音频流搭载在 WebRTC 上。

[mozilla/WebRTC_API/交换 ICE 候选](https://developer.mozilla.org/zh-CN/docs/Web/API/WebRTC_API/Signaling_and_video_calling#%E4%BA%A4%E6%8D%A2_ice_%E5%80%99%E9%80%89) 中说：

这是在交换 ICE 候选，两个节点需要交换 ICE 候选来协商他们如何连接。每个 ICE 候选描述一个发送者使用的通信方法，每个节点按照他们被发现的顺序发送候选，并保持发送直到退出，即使媒体流已经开始传递也要如此。

candidates 的 API： [Web API 接口参考/RTCPeerConnection](https://developer.mozilla.org/zh-CN/docs/Web/API/RTCPeerConnection)

[mozilla/WebRTC_API/ICE cadidates](https://developer.mozilla.org/en-US/docs/Web/API/WebRTC_API/Connectivity#ice_candidates) 中有一句话：

> Note: Generally, ICE candidates using TCP are only going to be used when UDP is not available or is restricted in ways that make it not suitable for media streaming. Not all browsers support ICE over TCP, however.

## webrtc 隐藏使用 mDNS 隐藏真实 IP 的事情

[参考](https://blog.csdn.net/weixin_43915401/article/details/111830699)

## WebRTC ICE Candidate 的理解

[WebRTC中的ICE Candidate](https://zhuanlan.zhihu.com/p/476577799)

并提供了知识拓展的 Github 库：[gongluck/AnalysisAVP](https://github.com/gongluck/AnalysisAVP)

顺着查到了 [ICE Candidate Interface](https://www.w3.org/TR/webrtc/#rtcicecandidate-interface)

## 问题记录

- 2023年6月23日，奥克斯
  - 现象：webrtc SDP 携带 `a=candidate:2792747077 1 tcp 1518280447 10.12.102.62 9 typ host tcptype active generation 0 network-id 1`，最后 INCOMPATIBLE_DESTINATION 挂断
  - 原因：不应该携带 tcp 的 candidate，端口 9；FreeSWITCH 逻辑中非 udp 的会直接忽略
  - 进度：通过 `edge://webrtc-internals/` 或 `chrome://webrtc-internals/` 可以捕获一些信息
- 2023年7月19日，美宜佳
  - 现象：webrtc SDP 携带 `a=candidate:2745181205 1 udp 2122262783 240e:3b3:30b0:da30:2cc5:4631:5f4e:13 50098 typ host`，导致 CODEC NEGOTIATION ERROR
generation o network-id 2 network-cost 10
  - 原因：即获取到了 IPv6 的地址进行协商媒体流
  - 修复：网卡中设置项关闭了 IPv6，解决
- 2023年8月18日，美宜佳
  - 现象：webrtc SDP 携带 `a=candidate:4068362253 1 udp 2122257663 2002:200:1::200:1 59661 typ host generation 0 network-id 3 network-cost 50`，然后 `Drop audio Candidate cid: 1 proto: udp type: host addr: 2002:200:1::200:1:59661 (no network path)`，最后 INCOMPATIBLE_DESTINATION 挂断
  - 进度，`2002:200:1::200:1` 这个看起来像是 *6to4隧道* 的地址（参考[华为设备-IPv6过渡技术之 6to4 自动隧道](https://zhuanlan.zhihu.com/p/456730854)）
