# Note Of Mastering Regex

- `[]`中的`^`只在紧邻"["时，才是元字符 **非**的意思。（元字符：特殊意义的字符）
- `[]`中的`-`在紧邻"["或"]"时， **不是**元字符。两边不是它们时，表示范围。
- `[]`中的`.` **不是**元字符。
- `[]`中的`|` **不是**元字符。
- 所以：
    - `[.-/]`表示匹配一个字符，它的编码是 **从**"." **到**"/"
    - [`-./]`表示匹配一个字符，它是"-"、"." **或**"/"

- 正则`gr[ea]y`和`gr(e|a)y`没太大区别，但意义不同。
前一个是 **字符组**，只作用于单个字符；后一个是 **多选结构**。
- 多选结构的 `|` 的优先级很低，所以时刻注意加括号。正则 `^From|Subject|Date:*`等同于 `(^From)|(Subject)|(Date:*)`

- 单词边界"\b"或"\<"和"\>","<"本身不是元字符，加上"\"后是了。

- 四种量词： `?`, `*`, `+`, `{}`
    + `?`: 有一次或无
    + `+`: 有，一次或多次
    + `*`: 无，一次或多次
    + `{}`: 区间量词，开区间，闭区间，固定次数

- 在egrep中，转义字符在字符组`[]`中无效，而大多数工具语言中有效。

- 括号的三种作用：
    + 限制多选结构（和"|"配合）
    + 分组
    + 捕获文本（反向引用）

- 括号分类
    + 捕获型括号：`(……)`。简化示意图`($1($2)($3))($4)`，存入的变量按括号的 **起始位置**算。（P90）
    + 非捕获型括号：`(?:……)`，只用于分组，不捕获变量。注意嵌套`($1(?:)($2))($3)`， 变量的编号。
    + 非捕获型括号比捕获型括号 **效率**更高。

- 环视：
    - （喻释）你站在一个位置，看看前(逆序)/后(顺序)有(肯定)/没有(否定)谁，但只是看看而已。
    - （解释）它返回这么一个匹配，以这个匹配以基准环顾四周看看是否正好能匹配要匹配的东西，若有则返回这个匹配。


- 肯定环视：
    + 顺序肯定环视：`(?=……)`。某某的后面有……。
    + 逆序肯定环视：`(?<=……)`。某某的前面有……。

- 否定环视：
    + 顺序否定环视：`(?!……)`。某某的后面没有……。
    + 逆序否定环视：`(?<!……)`。某某的前面没有……。

- 例：
    + 正则`(?=Jeffrey)Jeff`和正则`Jeff(?=rey)`是等价的。
    + 正则`(?<=\bJeff)(?=s\b)`表示，找这么一个位置(因为这个匹配为空字符串)，它的前面正好匹配`\bJeff`，后面匹配`s\b`。
    + perl语法 `s/(?<=\bJeff)(?=s\b)/'/g`表示，找所有的这么一个位置，它的前面匹配`\bJeff`，后面匹配`s\b`，然后把这个位置替换为撇号。
    + perl语法 `s/(?<=\bJeff)abc(?=s\b)/'/g`表示，找所有的这么一个`abc`，它的前面匹配`\bJeff`，后面匹配`s\b`，然后把这个`abc`替换为撇号。

- Modifier：`/g`, `/i`, `/m`, `/x`
    + `/g`的作用。首先，你要了解这么一个规则，正则匹配到一个位置后，下一你匹配会从这一个位置开始。（P68）
    而`(?=……)`匹配到的内容不会改变这个匹配位置（这个点还是在括弧的前面），可以说这就是环视的特性。
    + `/i`, 规定不区分大小写
    + `/m`， 让字符串转换为逻辑行模式。在字符串操作中，常常可能一串字符中有'\n\r'的编码标志(CR是回车，NL是换行)，/m模式可以识别他们。
    + `/x`，宽松排列。会忽略正则中字符组外的空白,但字符组内的仍有效，此模式下可以加注释。

- 例： 解析数字，加上适于阅读的逗号 (p64)
    + `perl -p -i -e 's/(?=(\d{3})+\b)(?<=\d)/,/g' ./test`
    + `perl -p -i -e 's/(\d)(?=(\d{3})+\b)(?<=\d)/$1,/g' ./test`
    + 注意这里的加号的解读，`(\d{3})+`表示后面的`\d`是3的倍数时，才是正确的匹配.所以后面有9个时(是3的倍数)能匹配到，下次匹配就是匹配到后面是6个时，再下次就是匹配到后面是3个时.

- See the supportability between BREG or EREG
    + ![Supportability between BREG or EREG](./BasicOrExtendedSupportability.png)

- See the supportability among some REG utils
    + ![Supportability among utils](./ModernUtilSupportability.png)

- 注意 **语言** 中的 **元字符** 在 *正则语句* 中使用时的冲突问题,有时，要加两个转义符号 **\\** 
