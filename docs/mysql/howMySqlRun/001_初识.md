# 初始

- C/S 架构
- 安装目录：/usr/local/mysql
- TODO：如何查看安装目录

## 二进制文件

- mysql: 客户端，启动时仅 `-p` 要紧跟密码，不能带空格，其他参数都可以带（`-P port`）
- mysqld: 启动一个 mysql 服务器实例进程（但不常用）
- > 下面三个本质是 shell 脚本，可打开查看
- mysqld_safe: mysqld + 监控、自动重启、错误日志（mysql 数据目录中 .err 文件）
- mysql.server: mysqld_safe + 安全启动/停止（`mysql.server stop`）
- mysqld_multi: 在一个机器上启动/停止多个服务器实例

## 连接方法

- TCP/IP: 默认 3306 端口，
- Windows 上可用命名管道或共享内存方式
- UNIX 套接字：限本机连接，默认 `/tmp/mysql.sock`，用 `--socket=/tmp/a.txt` 变更

## 流程

Client -> 1. 连接管理 -> 2. 查询缓存 -> 3. 语法解析 -> 4. 查询优化 -> 5. 存储引擎 -> 6. 文件系统 （1-4 为 Server 层）

- 连接管理：连接创建、认证、线程池（缓存线程，节省开销）
- 查询缓存：
  - 缓存请求和结果
  - 在不同的客户端间共享结果
  - 任何字符变动会命不中缓存
  - 部分系统函数无法缓存（如 NOW 函数）
  - 表级别更新操作会将缓存全部删除
  - 缓存的维护消耗很大的性能（v5.7.20 之后不建议用，v8.0 之后完全弃用）
- 语法解析：词法解析、语法分析、语义分析
- 查询优化：外连接转内连接、表达式简化、子查询转换为连接等，最后生成**执行计划**（本阶段有可能会访问数据）
- 存储引擎：负责如何存、如何写、怎么读的问题。

> 一般我们将 2 还说成 server 层，将 3 说成引擎层；server 层和引擎层交互是以**记录**为单位的；
> server 层按执行计划向引擎层请求记录，获取后判断 where 条件，先存储于 server 层缓冲区中，待满后发给客户端。

## 常用存储引擎

- InnoDB，最常用，支持事务、行级锁、外键
- MyISAM，主要用于非事务的存储引擎
- MEMORY，数据存储于内存，多用于临时表
- CSV
- 等

```sql
-- 创建指定引擎
CREATE TABLE 表名(
    建表语句
) ENGINE = 引擎名称;

-- 修改引擎
ALTER TABLE 表名 ENGINE = 引擎名;

-- 查看引擎
SHOW CREATE TABLE 表名;
```
