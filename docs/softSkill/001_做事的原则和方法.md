# 做事的原则和方法

> 注：
> 章节内的例子只为了论证问题的重要性，还请大家不要介意。
> 问题大家可能都存在，与大家共勉。

## 认真负责，关注细节，追求卓越，结果闭环

- 每一份需求都要理解之后再动手，感觉需求不合理或不明确的要提出来讨论，对整个产品要有责任心，不仅仅是“按部就班”地做事情。

- 代码提交前仔细测试自己实现的功能，检查代码细节，有高质量交付代码的责任心，而不是依赖其他成员 Reivew 或者 QA 测试。（写代码是第一道防线，Review 是第二道防线，测试是第三道防线……）

- 代码仅仅可以工作是不够的，还要可读、易扩展、可维护、安全、高效等，要用高标准要求自己，写代码要“上心”，认真写好每一行，不要敷衍、随意。

- 细节不一定决定成败但却可以充分体现一个人的工作态度，请认真对待各种流程、规范，比如写英文邮件时，从语法、格式到每一个拼写、标点，再比如 Commit Message 的格式、Coding Style 等等。

## 自我驱动，扩充自己的能力

- 深入了解业务以及实现。线上正常业务问题中，遇到问题不知道业务逻辑、没有思路、逻辑不清走错方向就是因为自己对业务和实现不了解。有了全面的了解，才能一针见血定位并解决问题。

- 自觉深入学习相关技术，价值体现往往是厚积薄发。问题定位过程中总是要用到自己积累的知识的，尤其是那些疑难问题，这是自己价值闪光的地方。

- 多问自己为什么，不要让别人（甚至外行）问合理的问题还将你问倒。实例经验：“为什么在正常呼叫过程中分机状态没有变更记录” -> “在这段时间内没有收到 CHANNEL_CREATE 事件”，下一个很合理的提问将是“为什么没收到 CHANNEL_CREATE 事件”（正常呼叫必然产生这个事件）。这样的结论不能让人信服，自己要主动向自己提问题并解答，如果是进度，最好说明一下这是进度，后面自己还在调查。

## 用正确的方式解决问题，从根源解决问题

- 问题的一般定位思路是：收集现象 -> 做出推论、假设 -> 实验验证 -> 得出结论，不断循环直到得出最终结论。

- 有条理、有逻辑、有理论基础地定位问题，不要靠臆想“觉得”问题发生在什么地方就以此为真。

- 从根本上解决问题，思考问题发生的根本原因，不要停留于表面问题的修修补补，补了东墙坏了西墙，问题不断出现，这时候就要跳出问题重新考虑根本原因。（例子：ASR）

实例经验：

- 如在定位到“WebRTC 模式是坐席 DTLS 握手慢导致坐席侧语音流会延迟几秒”的问题过程中。在用户报“电话接通后坐席侧不播放工号”问题时，多问一些客户现象，确定了现象后，推论哪里出了问题，然后一步一步去查——拿到问题最后到代码细节中去定位的路子就走错了。

- 如 ASR 问题一直缝缝补补，问题一直得不到根本解决，最终重新设计。

## 磨刀不误砍柴工

- 工欲善其事，必先利其器。平时要注意效率工具的积累和学习。如 Linux 三剑客 grep、awk、sed，可以帮助自己提高工作效率。还比如代码编辑器各种插件、高效的命令行工具、高效的截图工具等等。

- 对于你常用的编辑器或 IDE 应该花一些时间去熟练它的快捷键，寻找一些好用的插件，毕竟工作每天都要用，投入的精力绝对物超所值。（如 Goland 根据接口查询实现、查看定义位置、查看使用位置、查看变量读使用的位置、变量写使用的位置等等）

- 学习新知识要尽可能的系统、全面，不要只是为了应付当前工作片面了解。使用第三方库、框架时应尽量通读其文档，（至少）要知道它可以做什么，有哪些限制，遇到具体问题后可以迅速到文档中查看细节。

- 常用的技术点要舍得花时间搞清楚其运行原理、内部机制，免得每次出问题都像无头苍蝇，只靠猜，不专业。

## 靠自动化，不要靠人力

- 要有成本意识，任何资源都可以是成本，时间成本，精力成本……不要将时间花费在重复劳作上，不要将精力花费在徒劳无功上，而且我们作为开发天然就有创新的能力，搞一些脚本可能信手拈来，解放人力、提高效率。

- 人是最容易犯错的，尤其在最放松或最紧张的时候，而代码不会（代码跑错是人造成的）。所以我们要用自动化工具去避免人力，或者用流程去规范人力。

实例经验：

- 我们线上发版会影响客户呼叫，发版过程中总会有一些客户跳出来问是不是正在发版，先前人工通知的工作慢慢就通知不下去了，放在审批的环节自动去通知，就不会被遗漏；
- 我们线上发版都是用流程消除可能都人为失误：发版人专注于发版、检查人专注于检查、第二天还有巡检，流程意识不强、做不到位是件很危险的事——历史灾难马上就要重现了。

## 靠规范，不要随意

- 任何规范制定出来都是有原因的，“历史在重演”就是因为规范没有被贯彻实行下去，随着时间的推移大家意识逐渐淡化，直到故障发生流程再次被提及。流程上一旦有执行不到位的问题，就需要再次强调下。

- 代码规范也是如此（后面要搞），代码规范可以避免开发者对一些语法特性不熟而导致一些 bug 产生。比如 go 语言中初始化 map 用 `m := make(map[string]string, 10)` 而不是 `var m map[strint]string`，是因为后者在定义后直接取值就会发生 panic，有了代码规范可以避免这类“新手”才会出现的错误。实例经验：go 代码中有将切片当引用传递在函数间传递使用的情况，我默默修复了。

- 好的代码规范还能减轻后期的维护工作，比如命名规范、注释规范、卫语句等等。写代码就要像写作文一样，有些代码阅读起来就很赏心悦目（虽然一般看别人的代码都很难，但对于糟糕的代码的认知总能达成一致），而有些则让人极力克制着掀桌子的情绪。如果你没接触过代码规范，那从现在起就要培养了。

> 谷歌出的代码规范：[Google Go Style Guide](https://gocn.github.io/styleguide/docs/01-overview/)

## 用标准，不要随意（专业化）

用一些业内的标准，不要违反这些标准，这也是个人的专业性的表现。如：

- HTTP GET 请求，将参数放在 Body 中传不符合标准，没有必要不能这样做。

- HTTP 响应状态码，4xx 就是请求的错误，404 就是 Not Found，限流就要用 429，服务端的错误才用 5xx。将客户端的错误定义成 500 不符合标准。

- 流程图画法，菱形就是条件分支，有 true 和 false 两种判断。流程分支只有 true 分支，没有 false 分支不符合标准。

## 使用专业的工具

这是让自己高效的方法。

定位录音问题，就要用 Audacity 这样的专业工具，使用一个音频播放工具是很不专业的——连双声道单声道都看不出来。

工作必备：

- 抓包工具 Wireshark、tcpdump、sngrep；
- 截图工具 snipaste（有屏幕贴图功能）、FastStone Capture（编辑、录屏功能）；
- 工作效率工具：滴答清单（四象限分级）

## 知识管理

每个人都要进行知识管理，作为开发者尤其重要，这是开发者的基本素养。

可以网上搜索下知识管理的工具：幕布、印象笔记等。个人习惯于使用 Gitee 和 Github。

## 风险意识，防患于未然

“契诃夫之枪”理论：`"If it's not going to be fired, it shouldn't be hanging there."`。开发者要对这种 “**枪**” 有很高的敏感度。

实例经验：gitlab 上的生产环境分支、私有化生产环境分支加保护问题。试想一下，如果生产分支被某新员工误删除找不到了，谁的责任？新员工背吗——他可能只是无心的一个小失误。有些问题没有发生，可能只是 **还** 没有发生——枪在那里，随时都可能开火。

> “世界上最精细化高效协作的一个系统就是经济。”这是《薛兆丰经济学讲义》书上看到的，并且私以为很有道理，尤其是在看到“信用”章节的时候，在这个系统下，人人都保持着系统内正规的流程，不遵守者自然就会受到惩罚，各个节点相互牵制又相互合作，是真的精妙。要想让我们所在的系统高效协作，就一定要有合适的流程管理。

对于测试环境测出的极其偶现的 bug，在生产环境就是必现。开发人员都知道这点。在生产环境中成千上万甚至亿级别的人在使用，万分之一发生概率问题也会必然发生。所以发现了某问题，一定要追根究底搞明白出现的前因后果，评估它的影响，不要放过，放过就可能导致灾难。

实例经验：预测外呼功能。

主动沟通，向上汇报，现在不解决到后面自己就被动了。

## 团队意识，主动沟通

- 团队中任何你感觉不合适的问题都尽量提出来，影响到自己的或者看到影响到团队的，所有的问题都可以讨论、协调、缓解，甚至避免，优化我们整个团队的合作。

- 对需求、开发规范、代码组织等等各方面存在任何疑问时，主动询问和沟通，不是产品或领导交给自己的任务就需要无条件执行的，自己要有想法，有想法要拿出来讨论：这样做是不是必要的、是不是优先的……

- 进度存在风险时主动告知，不要默默拖。
