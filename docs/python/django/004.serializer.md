# 序列化器

## to_internal_value 

- 作用：将外部数据转换为内部 Python 数据（反序列化）
- 可以做：验证前的钩子，预处理数据（清洗、默认值、格式转换等）
- 执行时机：在调用 `serializer.is_valid()` 时，
  - 先调用此函数 `to_internal_value()`
  - 然后执行字段级验证（`required=True, max_length` 等）
  - 然后执行自定义验证方法（`validate(), validate_FIELD()`）
  - 最后通过 `serializer.validated_data` 获取转换后的数据
- 注意事项：
  - 必须调用 `super().to_internal_value(data)` 获取基础转换结果，避免遗漏默认处理逻辑
  - 有些字段类型是只读的类型，修改无法同步到 model
  - 数据不符合要求应该用 `serializers.ValidationError` 抛出异常
  - 避免在这个函数内做耗时操作（db 查询等）

## 序列化器中的字段类型

- 示例：如 `JSONField` 和 `SerializerMethodField` 等。
- 使用示例： `created_nickname = serializers.SerializerMethodField()`
- 特性：
  - 不同类型读、写的支持性不同，如 JSONField 就是可读可写的，SerializerMethodField 是只读的。读 是指模型序列化读出；写 是指反序列化输入。

## validate_xxx

- 序列化器中没有 `set_xxx` 的 hook，但可以用 `validate_xxx` 方法验证和修改单个字段

## 更新数据的验证

- 使用 `Model.objects.update(**data)` 的时候不会经过序列化验证（仅调用 `.save()` 会触发验证）
- 可以使用如下方式进行部分字段的

```sh
    serializer = UserSerializer(user, data={"email": ""}, partial=True)
    if serializer.is_valid():
        serializer.save()
    else:
        print(f"验证失败: {serializer.errors}")
```
