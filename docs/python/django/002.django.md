# django

[官方文档](https://docs.djangoproject.com/zh-hans/5.2/)

python Web 框架。MVC 架构，又常常被称为 MTV（Model-Template-View）。

安装

```sh
pip install django
 
# 检查版本 python
# import django
# django.get_version() # 5.2.4
```

## 路由的使用

ViewSet 是一组视图的集合，包含了 list, create, retrieve, update, destroy 等多种动作，要将 viewSet 转换成视图函数时（`.as_view()`）必须指定 HTTP 方法和 ViewSet 之间的对应关系，如：

```py
path('example', ExampleViewSet.as_view({'get': 'list', 'post': 'create'}), name='example')
```

由于我的视图提供了多个函数，所以必须明确指明动作映射到函数，或者运用路由的方式处理 URL 路由，如下：

```py
router = DefaultRouter()
router.register(r'robot-use', views.RobotUse, basename='robot-use')
urlpatterns = [
    # 包含路由器自动生成的URL
    path('', include(router.urls)),
]
```

 

## 视图的使用

[](https://pythondjango.cn/django/basics/8-views/#%E4%BB%80%E4%B9%88%E6%98%AF%E8%A7%86%E5%9B%BEview%E5%8F%8A%E5%85%B6%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86)

- 一个 url 的配置对应到一个视图
- 视图有两种实现方式：基于函数的视图（FBV，Func-Based View）；基于类的视图（CBV，Class-Based View）
  - 基于函数的视图比较直接，但没有类的继承和重用
  - 基于类的视图是将函数挂在类中，将不同的请求方式用类中不同的方法来区别
- 类视图：
  - 需要使用 `CLASS.as_view()` 将类伪装成方法
  
### 通用类视图 

- 通用类视图是 django 提供的，有：`ListView, DetailView, CreateView, UpdateView, FormView, DeleteView`
- 使用通用类视图后，只需要设置某些属性就实现了某些功能
- 自建类可以继承多个通用类视图，这样本类就复合了被继承者的所有功能了（这就是 django 的 ViewSet）
- 大多数通用视图需要使用 `queryset` 属性，他是 `QuerySet` 实例（Model 中的检索对象）
- `as_view()` 方法返回一个视图（入参为 request，返参为 response 的函数）

```py
class IndexView(ListView) # 实现了 ListView
    model = Article # 设置对应 model
    # 下面没有更多代码，这样的代码就实现了列表的获取（model，render 的 html）
```

- `DefaultRouter().register()` 函数可以直接将类注册在 `path_prefix` 下，同时提供对应的 model，这样可以直接注册 url 组和对应的函数组

```py
router = DefaultRouter()
router.register('path_prefix', ClassForViewSet, basename='model_name')

urlpatterns = [
    path('', include(router.urls))
]

# 如上，等价于 
# GET /path_prefix => ClassForViewSet.list()
# GET /path_prefix/ID => ClassForViewSet.retrieve()
# 如果不需要覆写类中特定方法，那类中也不需要定义函数，如下视图的代码仅需要定义
class ChannelViewSet(ModelViewSet):
    serializer_class = ChannelSerializer
    queryset = ChannelModel.objects.all() # 仅需要定义这两个变量即可
```

### APIView 和 ViewSet 

- APIView 是 django 的 View，其 `as_view()` 不接受任何参数，只能处理固定的 HTTP 方法（get、post）
- ViewSet 需要通过 `as_view()` 将 HTTP 方法绑定到具体的 action 上，如 `as_view({'get': 'list', 'post': 'create'})`

### 类视图中的装饰器 

- ` @action(methods=['POST'], detail=True, url_path='disable')`


