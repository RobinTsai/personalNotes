# wireshark

```sh

# -A 表示以可读的 ASCII 方式显示； 0x504F5354 代表的是 P O S T的ASCII码.
tcpdump -i any -s 0 -A tcp port 4014 and 'tcp[((tcp[12:1] & 0xf0) >> 2):4] = 0x504F5354' # 抓包 4014 http POST 接口

```

## 导出 RTP 语音流

```sh
# 这里只能导出 rtp 的包，以 .rtp 文件命名，使用 wireshark 打开
电话 - RTP - RTP 流 - Export
# 这里能导出音频文件，SSA / FSA 如 WAV 格式；Payload 算是压缩的 PCM 格式，播放时候需要指定参数
电话 - RTP - Play Streams - Export - Stream Synchronized Audio / File Synchronized Audio
                                  \- Payload # 这时，导出的是原生的 payload, 即可能是 alaw 等，如在 audacity 中导入要选择编码 A-law
```

## 配置环境变量让 wireshark 解密 HTTPS

1. 设置环境变量 `SSLKEYLOGFILE` 指定某 log 文件
2. 设置 wireshark：编辑 - 首选项 - Protocols - TLS - (Pre)-Master-Secret log filename 配置为创建的 log 文件

> 原理：
> 配置 `SSLKEYLOGFILE` 的作用是让浏览器在 TLS 握手过程中将生成的会话密钥写入指定的文件。
> wireshark 读取指定的文件查看明文数据。

测试：

- 只有先打开抓包，再打开浏览器，然后进入相应的页面能抓到包
- 有些 http 是 http2 注意使用 http2 才能搜索到，还有 http3 的，可以通过 network 右键添加 Protocol 列查看版本
- 只有部分浏览器支持，Chrome 支持，无法抓包 edge 浏览器

问题：如果连了 vpn 后，wireshark 看不到对应网络接口，是需要将“网络设备-属性-Npcap Packet Driver” 打开
