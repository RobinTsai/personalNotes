# lk callbacks

- 要先理解：[什么是 Local 什么是 Remote？](./023.lk.faq.md#local-and-remote)
- 要清楚怎么订阅，

对象的理解：Participants、Publication、Track

## RoomCallback

```go
type RoomCallback struct {
	OnDisconnected            func()
	OnDisconnectedWithReason  func(reason DisconnectionReason)
	OnParticipantConnected    func(*RemoteParticipant)
	OnParticipantDisconnected func(*RemoteParticipant)
	OnActiveSpeakersChanged   func([]Participant)
	OnRoomMetadataChanged     func(metadata string)
	OnRoomMoved               func(roomName string, token string)
	OnReconnecting            func()
	OnReconnected             func()
	OnLocalTrackSubscribed    func(publication *LocalTrackPublication, lp *LocalParticipant)

	// participant events are sent to the room as well
	ParticipantCallback
}

type ParticipantCallback struct {
	// for local participant
	OnLocalTrackPublished   func(publication *LocalTrackPublication, lp *LocalParticipant)
	OnLocalTrackUnpublished func(publication *LocalTrackPublication, lp *LocalParticipant)

	// for all participants
	OnTrackMuted               func(pub TrackPublication, p Participant)
	OnTrackUnmuted             func(pub TrackPublication, p Participant)
	OnMetadataChanged          func(oldMetadata string, p Participant)
	OnAttributesChanged        ParticipantAttributesChangedFunc
	OnIsSpeakingChanged        func(p Participant)
	OnConnectionQualityChanged func(update *livekit.ConnectionQualityInfo, p Participant)

	// for remote participants
	OnTrackSubscribed         func(track *webrtc.TrackRemote, publication *RemoteTrackPublication, rp *RemoteParticipant)
	OnTrackUnsubscribed       func(track *webrtc.TrackRemote, publication *RemoteTrackPublication, rp *RemoteParticipant)
	OnTrackSubscriptionFailed func(sid string, rp *RemoteParticipant)
	OnTrackPublished          func(publication *RemoteTrackPublication, rp *RemoteParticipant)
	OnTrackUnpublished        func(publication *RemoteTrackPublication, rp *RemoteParticipant)
	OnDataReceived            func(data []byte, params DataReceiveParams) // Deprecated: Use OnDataPacket instead
	OnDataPacket              func(data DataPacket, params DataReceiveParams)
	OnTranscriptionReceived   func(transcriptionSegments []*TranscriptionSegment, p Participant, publication TrackPublication)
}
```

### OnTrackSubscribed

```go
// 参数：远端 Track，远端 Publication，远端 Participant
func(track *webrtc.TrackRemote, publication *RemoteTrackPublication, rp *RemoteParticipant)
```

是房间中任何的 Track 发生了订阅，就触发事件。

连接 Room 时默认会自动订阅，可以通过传入 opts `lksdk.WithAutoSubscribe(false)` 关闭订阅。


### OnLocalTrackSubscribed

```go
func(ltp *lksdk.LocalTrackPublication, lp *lksdk.LocalParticipant)
```

本地 Track 被订阅时触发。

> 我在这里获取到 `LocalTrackPublication` 中的 `TrackLocal` 后，调用 `UserPeerConnection.GetSenders()[0].ReplaceTrack(localTrack)` 后让用户听到了自己的回声。
