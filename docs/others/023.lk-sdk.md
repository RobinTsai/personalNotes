# lk-sdk

对象

- `TrackPublication` 表示音轨的元数据
- `Track` 表示原始媒体流

[媒体控制的文档](https://docs.livekit.io/home/client/tracks/)：

- 摄像头和麦克风
- 屏幕共享
- 订阅媒体
  - 轨道订阅 `RoomEvent.TrackSubscribed`
  - 媒体播放 `room.on(RoomEvent.TrackSubscribed, handleTrackSubscribed)`
  - 音量控制 `track.setVolume()`
  - 说话人识别 `RoomEvent.ActiveSpeakersChanged` 事件和 `ParticipantEvent.IsSpeakingChanged` 事件
  - 选择性订阅 `autoSubscribe: false` 禁用自动订阅
  - 前端 SDK：`publication.setSubscribed(true)`
  - 后端 SDK：`roomServiceClient.updateSubscriptions('room', "receiving-participant-identity"， ['TR_TRACKID'], true)`
  - 自适应流：用了 `Track.attach()` 自动的
  - 启用/禁用音轨（静音功能）：`publication.setEnabled(false)`（订阅和禁用的差别在于协商，订阅会协商握手，禁用不需要）
  - 直播推流控制：`publication.setVideoQuality(VideoQuality.LOW)`（展示视频缩略图时有用）
- 噪音/回声消除
- 端到端加密
- 编码等

[实时文本和数据](https://docs.livekit.io/home/client/data/)

- 发送文本：
  - 一次性发送 `room.localParticipant.sendText()`
  - 流式发送 `writer = room.localParticipant.streamText(); writer.write(text)`
  - 结束流 `room.localParticipant.registerTextStreamHandler()`
- RPC
  - 可以在一个参与者身上定义方法，然后被其他参与者调用，并获得响应
  - 如果用 AI Agent 的 Tool 调用，那么 LLM 可以直接控制前端数据
  - 客户端注册方法 `localParticipant.registerRPCMethod()`
  - 服务端触发调用 `localParticipant.performRpc()`

状态同步

- Participant 状态同步：`attributes` 和 `metadata`
- 这两个字段由 LiveKit Server 存储并管理的，并且会自动同步到加入 Room 的新参与者
- 删除属性直接设置为空字符串即可
- 这两个字段不适合高频率更新，若要更新考虑使用 data packets
- 两者大小限制为 64k
- 参与者令牌必须由 `canUpdateOwnMetadata` 才可以更新自己的属性或元数据
  - 方法：`localParticipant.setMetadata()` 和 `localParticipant.setAttributes()`
  - 监听：`room.on(RoomEvent.ParticipantMetadataChanged, ...)` 和 `room.on(RoomEvent.ParticipantAttributesChanged, ...)`
- SDK 可以使用 `RoomService.UpdateParticipant()` 更新任何参与者的属性
- 和 Participant 的 metadata 类似，Room 也有一个 metadata 属性，也有监听事件
