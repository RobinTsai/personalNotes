# 内存回收策略

redis 内存回收机制主要体现在两个方面

- 如何删除已过期
- 内存溢出如何控制

## 过期键删除

redis 用了两种方式

- 惰性删除：当访问到的时候判断过期删除
- 定时任务删除：内部定时任务，100ms 一次，一次随机检查20个键，若有 25% 过期则继续。
    - 快模式：最长运行 1ms
    - 慢模式：最长运行 25ms，有 25%

## 内存溢出控制

6 种

- noeviction：不控制，溢出的话会报错 OOM
- volatile
    - lru
    - random
    - ttl：若没有过期键，则退化成 noeviction
- allkeys
    - lru
    - random

## 配置信息

```
config set maxmemory-policy {policy}
```

## 触发时机

used_memory > maxmemory

maxmemory 是设置项，如果想触发回收，可以手动调小此配置项，然后执行一次查询命令，可以快速回收内存。