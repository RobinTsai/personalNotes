# 哨兵-客户端连接

哨兵模式下，因为主节点会有自动的故障转移，客户端直接连接主节点无法适配故障转移。所以客户端是先连接到哨兵获取到主节点再通信的。

重点：
- 客户端连接哨兵获取主节点
- 故障转移后，客户端更换主节点

## 流程

- 客户端遍历哨兵节点，连接到任意一个可用的哨兵节点
- 通过 `sentinel get-master-addr-by-name master-name` 获取主节点信息
- 验证主节点（`role` 或 `info replication` 或从上述命令中获取）
- 单独线程客户端保持和哨兵节点的“联系”监视变化

客户端保持和哨兵节点的“联系”是通过 **发布订阅** 实现的，通过订阅 sentinel 节点的频道 `+switch-master` 实现。

> 哨兵的在故障转移的各个阶段的行为都会通过发布订阅的形式对外提供，开发者可以订阅感兴趣的频道。