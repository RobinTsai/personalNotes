# 限流

从压力的角度应对系统故障。超出系统能力的访问请求将丢弃或拒绝。

- 对外部，针对于请求压力限流
- 对内部，针对于资源压力限流

## 基于请求压力限流

- 时间
- 请求量

## 基于资源压力限流

从内部考虑

- 连接数、进程数、线程数、CPU

难点：确定关键资源，确定阈值。

手段：
- 池化技术
- 请求队列，限制队列大小
- 读 CPU 使用率限流

## 算法

计数器、固定时间窗口、滑动时间窗口、漏桶、令牌桶。

固定时间窗口 无法应对突刺的问题
滑动时间窗口 将突刺更细化
漏桶 恒定的时间间隔（队列）释放可用量。请求均匀。
令牌桶 


令牌桶：时间控制、channel 控制

保证自己的系统不被打垮：用令牌桶；保护他人的系统不被打垮：用漏桶。

## 运维

- 提前压测，参考结果（根据时间不同，数据量也不同，所以压测要隔段时间就压）