# CDN

大型系统会部署多个节点做优化。

请求多个节点如何做优化：
- 分配到多个节点
- 就近访问：让用户请求落地离用户最近（网络拓扑最近）的节点
- 放静态资源

CDN 的关键节点：
- 源站：核心业务系统，所有信息的源头。
- 缓存节点（边缘节点）：缓存静态资源。

流程：
- 用户先在 CDN 读数据
- CDN 有则返回，没有去源站读数据
- 源站取到后回到 CDN 根据配置规则，是否存储到此 CDN

节点数目是不是越多越好：
- 好处：加速访问
- 坏处：成本、数据同步成本

CDN 优点：
- 减少系统每个服务的并发数
- 减少响应时间
- 减少网络拥堵

特点：
- 只缓存静态内容，动态内容不缓存，源站处理。

> CDN 全国能做的没有几家，所以不需要想着实现了，会用、懂原理就行。面试题可能问，所以下方简单实现下。
> 一般运营商是要向 CDN 服务商购买 CDN 节点及 CDN 服务。

设计CDN（关键要素及解决）：

- 识别用户来源：IP 地址定位
- 做就近分发：通过 DNS 解析 CName 将域名映射到另一个局部地域的域名进行访问
- 做内容缓存：根据配置规则实现缓存，xxx.html

扩展数据来源：
- 启动时初始化，内置好
- 增量更新，有效期

## 总结

> DNS 有 A 类型、CName 类型、NS 类型

（流程类似于注册中心）

- 地址获取
    - 用户发起请求 
    - LDNS 等所有 DNS 解析域名，最后 会转换为 CDN 服务商的域名
    - CDN 服务商节点根据 **规则** 找出 **目标 CDN** 节点
    - CDN 服务商节点把目标 CDN 节点的 IP 返回给 LDNS，最终返回给用户
    - 用户拿到最近 CDN 节点 IP
- 内容的请求
    - 用户访问 CDN 节点（有内容直接返回内容）
    - CDN 取源站获取
    - CDN 将源站内容根据规则缓存
    - CDN 返回给用户