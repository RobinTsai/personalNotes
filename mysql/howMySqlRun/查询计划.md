# 查询计划

MySQL中的EXPLAIN命令可用于查看查询语句的执行计划，它会返回一张表格，该表格包含了MySQL优化器在执行查询时所使用的各种信息和策略。下面是常见的几个字段解释：

- `id`：每个SELECT语句都被分配一个唯一的ID号，这个ID号从1开始递增；
- `select_type`：描述了查询类型，比如是否简单的从一个表中读取数据，还是连接多个表，或者是UNION操作等；
- `table`：给出了表的名字；
- `partitions`：给出使用的分区，如果有的话；
- `type`：查询使用的访问类型，包括常用的ALL(全表扫描)、index (利用索引进行匹配)等；
- `possible_keys`：可能使用的索引；
- `key`：实际使用的索引；
- `key_len`：表示索引的长度；
- `ref`：显示索引的哪一列被使用了；
- `rows`：表示MySQL认为必须检查的用来返回请求数据的行数；
- `filtered`：表示这个结果集的过滤程度，在 0~100 之间，值越大表示过滤越彻底，越小表示有更多的行被扫描；
- `Extra`：展示了MySQL对于查询的优化不同阶段所做出的操作，比如是否使用了临时表、是否使用了文件排序、是否使用了索引覆盖扫描等。

这些字段提供了关于查询执行的丰富信息，可以帮助用户识别瓶颈和优化查询性能。

key 的可能取值：

- `NULL`：表示没有使用索引；
- `PRIMARY`：表示使用了主键索引；
- `UNIQUE`：表示使用了唯一性索引；
- `index_name`：表示使用了名为index_name的普通索引。

ref 显示了**连接操作**用到的索引列或常数。

- `NULL`：没有使用索引
- `const`：使用**主键**或**唯一索引**的等值查找（唯一）
- `eq_ref`：表示使用了**等值连接**，比如查询两个表之间的外键关系()；
- `ref`：在二级索引中的等值查找（和 const 不同是，ref 的查询可能有很多等值）
- `ref_or_null`：二级索引等值查找时包含 null 值的查找（用 OR）
- `range`：区间扫描
- `index`：二级索引的覆盖查询
- `all`：全表扫描
- `index_merge`：索引合并
    - `intersection merge`：求交集时两个索引有相同的主键排序的查询
    - `union merge`：求并集时两个索引有相同的主键排序的查询
    - `sort-intersection merge`：求并集时，两个索引没有相同的主键排序，使用内存排序后进行并集的查询

> 注：没有 sort-intersection merge 的查询，没设计，可能基于这样的想法：排序 + 交集 的考量 vs 逐个回表查询 的考量。

Extra 的取值和意义：

- `Using filesort`：表示需要使用文件排序来处理查询结果；
- `Using temporary`：表示需要使用临时表来处理查询结果；
- `Using index`：表示可以通过覆盖索引扫描来处理查询，避免访问表本身；
- `Using where`：表示必须根据 WHERE 子句中的条件过滤行，而不能直接使用索引；
- `Using join buffer`：表示需要使用连接缓存来处理 JOIN 操作；
- `Impossible WHERE`：表示 WHERE 子句中的条件总是 false，因此不会返回任何行；
- `Select tables optimized away`：表示优化器已经发现相应的联接不需要执行，并将其从查询中删除；
- `DISTINCT`：表示需要对查询结果进行去重操作。

> Extra 中 Using filesort 解释：
> 文件排序是一种对查询结果进行排序的方法，它需要将查询结果存储到临时文件中，然后在文件上执行排序操作，最后返回排序后的结果。
> 这种方法通常会导致较慢的查询性能，因为它涉及到磁盘I/O操作和额外的内存开销。
