# awk

语法： `awk '匹配模式{动作}' 文件列表`

## 示例

```sh
awk 'NR==5{print $0}'       file  # 匹配 第5行，打印 全行
awk 'NR==5,NR==8{print $0}' file  # 5到8行
awk 'BEGIN{print "Start:"} {print $1}' file
```

## 变量

### 内置变量

- `$n` n 为 0 表示行内所有列，第一列从 n = 1 开始
- `NF` 列数  number of field，也即最后一列的下标
- `$NF` 最后一列
- `NR` 行号 number of record
- `FS` 输入的 field 分隔符，默认空格，可用 `-v FS="\t"` 或 `-F "\t"` 修改
- `OFS` 输出 field 分隔符，默认空格，可用 `-v OFS="\t"` 修改
- `RS` 输入的行分隔符，默认 `\n`，如 `-v RS=" "` 则将空格作为行分隔符
- `ORS` 输出的行分隔符，默认 `\n`
- `FILENAME` 当前文件名
- `FNR` 各文件分别计数的行号（一条命令中可以传多个文件）
- `ARGC` 命令行参数的个数
- `ARGV` 数组，参数列表，`ARGV[0]` 对用 `awk` 本身，`ARGV[n]` n>0 表示文件列表中对应的参数
- AWK 显示输出字符串，必须外侧单引号，内测双引号，变量不能用双引号括住

注意点：

- 内置变量直接使用，不加前缀 `$`
- 命令文本必须使用单引号，内侧文本使用双引号

### 自定义变量

- `awk -v name="value" 'BEGIN{ print name }'`，定义变量并使用
- `name=value; awk -v name=$name 'BEGIN{ print name }'`，使用外部变量

## 匹配模式

语法：`awk '匹配模式{动作}' 文件列表`

- `BEGIN` 在处理所有文本之前执行动作
- `END` 处理完所有文本之后执行的动作

## 动作

语法：`awk '匹配模式{动作}' 文件列表`

- `{}` 可以认为是个循环体，默认是一直循环，当前面有 `BEGIN`、`END` 时特殊
- `print` 打印
- `printf` 带格式化的打印，默认无换行 `{printf "%s\n",$0}` 等同于 `{print $0}`
    - `%-5s` 表示字符串左对齐，5 个字符长度，`+` 表示右对齐


> 注意区分：
> shell 中的 printf 是这样的 `printf "%s\n" a b c d` 相当于对输出 `a\nb\nc\nd\n`，即对每个输入都执行一次 `%s\n`
> 这里的 printf 和 go 语言中的一样，是 `%s` 和参数对应输出的
