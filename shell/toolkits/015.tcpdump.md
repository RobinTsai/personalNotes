# tcpdump

```sh
tcpdump -i any -s0 -w abc.pcap

tcpdump -i eth0 tcp port 4022 -w tower-ws.pcap
tcpdump -i eth0 src 10.11.54.184 tcp port 8080 -w apigw-tower.pcap # 只能抓到来源 IP 到目的端口的 tcp 包，看 http 的话没有响应

sudo tcpdump host 10.11.54.184 and port 8080 -w apigw3.pcap

tcpdump -i any -r abc.pcap # 打开本地抓包文件 abc.pcap
tcpdump -i any -r abc.pcap port 4002 # 打开本地抓包文件 abc.pcap，过滤 4002 端口的包
```

- `-F filter_file`: 指定过滤语法的文件
- `-r file`: 从 file 中读包（file: 保存在本地的 pcap 文件）


http.request.uri > "/ws?AppId=7b4f2c27-0cce-468e-4042-1402293c0f5a&AgentId=" and http.request.uri < "/ws?AppId=7b4f2c27-0cce-468e-4042-1402293c0f5a&AgentId=a"

(http.request.uri >= "/ccapi/v2/agent/get_state?AppId=7b4f2c27-0cce-468e-4042-1402293c0f5a" and http.request.uri <= "/ccapi/v2/agent/get_state?AppId=7b4f2c27-0cce-468e-4042-1402293c0f5b") || (http.response.version == "HTTP/1.1" and http.response.code != 200)


{"_func":"udesk/tower/transport/websocket.(*TSocket).WriteMessage","_level":"info","_loc":"base.go:278","_time":"2023-06-27T12:47:23.204511246+08:00","conn_id":"963ca0f53dc24ffb78dda7ae58486d09","msg":"WriteMessage:{\"rcode\":\"000036\",\"rdesc\":\"GetState error:Get \\\"http://10.11.54.185:8080/ccapi/v2/agent/get_state?AppId=7b4f2c27-0cce-468e-4042-1402293c0f5a\\u0026MsgId=168784123897274241\\u0026Sid=123456789abcdef\\u0026Sign=1a3d77046a7d42dcf85962904468a5dcc5187d9b\\u0026Timestamp=1687841240\\u0026app_id=7b4f2c27-0cce-468e-4042-1402293c0f5a\\u0026timestamp=20230627124720\\\": context deadline exceeded (Client.Timeout exceeded while awaiting headers)\"}"}
