# warroom

## 角色

- 总控：总指挥，组织和协调。组织事故处理团队，按需求和优先级安排任务
- 处理团队：定位和解决问题。
- 记录员：记录文档（群公告）。
- 发言人：对外反馈，处理进度等。

## 流程

- 事件发生前
  - 创建好 Warroom 群
- 事件发生时
  - 收到告警或售后反馈问题
  - 判断是否为“大事件”，启动 warroom 流程
- 事件处理中
  - 第一要务：快速恢复服务（熔断、降级、负载、舍小保大）
  - 总控：指挥作战
  - 研发团队：现象、推论、定位、解决
  - 记录员：记录信息和处理进度（群公告）
  - 发言人：对外反馈
- 事件处理后
  - 数据恢复
  - 复盘和总结

## 指导方针

- 拉 Warroom 的时机：
  - On-Call 告警：可能对客户关键业务产生影响
  - 客户反馈问题：客户关键业务受到影响
  - 有两家或以上客户报严重问题（但可能还没有其他信息）
- 第一要务：<font color=red>首要止损！！！恢复业务！！！降低影响范围！！！</font>
  - <font color=red>询问是否发版，发版进行回滚！！！</font>
  - 切断某产生问题的租户
  - 熔断降级
  - 负载切换
  - 限流、切流
- 快速排查表（看板检查，及指定位置定位）
  - 服务器状态：磁盘、网络、CPU、内存、平均负载、连接、目录权限等
  - 服务进程状态：资源占用情况、是否重启、流量、延迟、错误日志
  - 中间件进程状态：启动状态、连接状况、资源使用情况、慢日志等
  - 日志输出
- 排障
  - 现象（贴出来，可能是：某资源占用高、某异常日志）
  - 推论（贴出来，指明是推论还是猜测，理论支持是什么）
  - 验证（贴出来，给出验证方法，供他人检验）
  - 解决（贴出来，获得同意后执行）
  - 检验是否恢复或缓解，重复如上流程，直到问题解决
- 善后工作
  - 丢失数据的恢复
  - 服务状态的恢复
- 复盘和总结
  - 事件时间线回溯（warroom 流程）
  - 问题根因回溯
  - 总结经验，分派任务：
    - 总结经验：处理流程、场景与操作
    - 研发任务：漏洞修复
    - SRE 任务：监控覆盖及健全
  - 记录备案
  - 公开奖励做正确事的人（绩效等）

## 技能要求

- 总控：联系人地图，什么模块联系什么人；头脑冷静；清晰的任务优先级认知
- 研发团队：
  - 快速恢复业务的手段、降低影响范围的手段
  - 通用的排障过程，以及对系统足够了解
  - 工具：日志筛选和分组、tcpdump、ping、nc 等，可用、会用
  - 现象 - 推论/猜想 - 验证 - 解决，要有证明供人检验，避免错误引导
- 发言人：要知道对外什么该说，什么不该说
- 记录员：问题精准记录，放到公告位置
